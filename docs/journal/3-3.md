---
title: 3월 3주차 보고서 (0318-0324)
layout: default
nav_order: 1
parent: 개발보고서
---

작성일 : 2024-03-24

```
  💡 회의 규정

  주간 회의는 최소 총 2회로 오프라인 회의(월), 온라인 회의(화~금)로 구성된다.
  필요 시 온라인 회의도 오프라인 회의로 변경할 수 있다.

  월요일 오프라인 회의 및 개발 진행 (18시 이후)
  장소 : 인천대학교

  온라인 회의 및 개발 진행 (평일 : 20시 이후)
  장소 : 디스코드
```

### 3월 3주차 (0318-0324)

---

- **1차 오프라인 회의 )** 2024-03-18 **( 18:00 ~ 21:00 )**
- **2차 온라인 회의 )** 2024-03-24 **( 10:00 ~ 12:00 )**

> 팀원 **전체가 참여**한 회의만 기록하였습니다.

## **주요 업무**

---

- 라즈베리파이 세팅
  - OS 설치
  - opencv 설치
- 특정 색을 이용한 공 추적
- HW 디자인 설계

## **진행 상황**

---

**3월 18일 퍼팅서포터 주제 승인**

**물품 리스트 최종 작성 및 구매 요청 진행**

| 번호 | 상품코드 | 상품명(옵션명)                                                                  | 제조사                       | 링크                                               | 수량 | 단가   | 합계금액 |
| ---- | -------- | ------------------------------------------------------------------------------- | ---------------------------- | -------------------------------------------------- | ---- | ------ | -------- |
| 1    | 14836578 | SEN0158                                                                         | DFROBOT                      | http://www.devicemart.co.kr/goods/view?no=14836578 | 2    | 39,350 | 78,700   |
| 2    | 6969388  | IR333C/H0/L10                                                                   | Everlight Electronics Co Ltd | http://www.devicemart.co.kr/goods/view?no=6969388  | 10   | 420    | 4,200    |
| 3    | 12298706 | LR건전지-A76 LR44(1판=10EA)                                                     | 블루텍건전지                 | http://www.devicemart.co.kr/goods/view?no=12298706 | 1    | 1,820  | 1,820    |
| 4    | 886      | 1/4W 5% Axial Resistor 331J (330Ω)                                              | 제일전자                     | http://www.devicemart.co.kr/goods/view?no=886      | 10   | 13     | 130      |
| 5    | 7815     | BHL44SMD(for LR44)                                                              | COMF (중국)                  | http://www.devicemart.co.kr/goods/view?no=7815     | 6    | 300    | 1,800    |
| 6    | 1265700  | 아두이노 나노 호환보드 FT232RL [SZH-EK017]                                      | SMG                          | http://www.devicemart.co.kr/goods/view?no=1265700  | 2    | 7,000  | 14,000   |
| 7    | 13003668 | 아두이노 나노용 데이터 케이블 USB A to USB mini B 25cm [SZH-CAB46]              | sync                         | http://www.devicemart.co.kr/goods/view?no=13003668 | 2    | 900    | 1,800    |
| 8    | 10889105 | 저음강화 2채널 스마트폰 3D 멀티 스피커 / USB전원 / 3W x 2 / Gold&Silver [BT426] | Coms                         | http://www.devicemart.co.kr/goods/view?no=10889105 | 1    | 14,600 | 14,600   |
| 9    | 1383853  | 아두이노 원격제어 IR 수신기 모듈 키트 [KIT050107]                               | YwRobot                      | http://www.devicemart.co.kr/goods/view?no=1383853  | 1    | 3,000  | 3,000    |
| 10   | 1362051  | 라즈베리파이 160도 광각 카메라 모듈 5MP [YR-019]                                | SMG                          | http://www.devicemart.co.kr/goods/view?no=1362051  | 1    | 34,200 | 34,200   |

기존 물품 리스트에서 품절된 상품이 없는 지 확인한 후 최종 구매 리스트 작성을 완료하였다.

3월 18일 디스코드 구매 요청 채널에 물품 구매 요청을 완료하였다.

물품이 도착하기 전까지 (약 1주일 소모 예상) 소프트웨어 개발 중심으로 진행하기로 결정하였다.

### **라즈베리 파이 세팅**

- Raspberry Pi imager 사용하여 OS 설치 진행
- vscode 등 개발 환경 및 기본 설정 구성
- **opencv 설치**
  1차 opencv 설치 과정에서 error 발생으로 시간을 많이 지체하여 venv 가상 환경을 사용하여 opencv-python 설치한 후 개발을 진행했다.

가상 환경은 다양한 프로젝트에서 패키지나 파이썬 버전 충돌 없이 작업할 수 있다는 장점이 있으나 소유한 라즈베리파이에서는 캡스톤 프로젝트만 진행할 것이며 환경 설정에 번거로움이 있어 구민성 팀원이 시스템 환경(전역)에 opencv 설치해오기로 하였다.

![1차 venv 가상 환경에 opencv 설치](/public/3-3/opencv1.png)

    1차 venv 가상 환경에 opencv 설치

![2차 시스템 환경에 opencv 설치](/public/3-3/opencv2.png)

    2차 시스템 환경에 opencv 설치

### **opencv를 이용한 공 추적**

실제 프로젝트에 사용할 카메라가 도착하지 않아 노트북 내장 카메라와 팀원이 소지한 웹캠을 이용하여 영상 스트리밍이 되는 것을 확인하였다.

Opencv camera 예제와 cv2.inrange 예제를 통하여 영상 출력이 제대로 되는 지와 이미지에서 특정 색 추출이 가능한 지를 확인하였다.

- **골프공 추적**
  <br>
  cv2.inRange를 이용했을 때 골프공을 제대로 인식하지 못하는 문제가 있었다.
  당시 조명에 따라 골프공의 색이 바뀌는 모습과 골프공 색 범위 설정이 제대로 되지 않는 것이 문제라고 생각하였다.

  1차 회의에서 팀원들과 해당 문제를 어떻게 해결할 것 인지에 대해 논의하였다.
  먼저 흰색이 아닌 골프공을 준비하여 해당 공으로 공 추적을 진행하기로 하였다. 또한 색이 있는 공 추적의 정확도가 떨어질 경우 기존 하드웨어 세팅 환경에 조명을 추가하여 빛에 대한 변수를 차단하기로 하였다.

  ![흰색골프공](/public/3-3/whitegolf.png)

  범위 : BGR(127, 119, 117) ~ BGR(214, 190, 174)에서 골프공이 인식되지 않는 모습이다.

  1차 회의 이후 색을 이용한 공 추적 코드를 수정하였다.
  노란색 골프공을 이용하였을 때 실시간으로 공 추적이 가능했다.

  ![노란색골프공1](/public/3-3/yellogolf.png)

  ![노란색골프공2](/public/3-3/yellogolf2.png)

  이미지 모멘트는 객체의 면적이나 무게중심을 계산할 때 유용하다.<br>
  cv2.moments() 함수를 이용하여 이미지 모멘트를 계산하였고 이를 이용해 공의 중앙 좌표를 구할 수 있었다.
  공 중앙 좌표를 하드웨어 실제 좌표와 매핑 했을 경우 공의 실제 위치를 제공할 수 있을 것으로 본다.

  ![600px 기준으로 공의 중심 좌표 출력](/public/3-3/golfcenter.png)

  600px 기준으로 공의 중심 좌표 출력

  분홍색 골프공으로도 공 추적을 진행하였다.

  ![분홍색골프공1](/public/3-3/pinkgolfball.jpg)

  색감이 강해서 식별하기 쉬울 거라 생각했으나, 생각보다 조명의 영향을 많이 받았다. 1차 실험은 카페에서 진행했는데 각종 조명과 다양한 색감 때문에 한 번에 적정 값을 찾기 힘들었다.

  2차 실험은 비교적 단조로운 배경에서 진행해보았는데, 아래 사진처럼 색을 잘 잡았다. 다만, 조금 오차가 존재해 앞으로도 몇 번 더 테스트 해보며 적절한 값을 찾을 것이다.

  ![분홍색골프공2](/public/3-3/pinkgolf2.png)

  특정 색 검출만 이용했을 때 카메라에 비슷한 색의 다른 물체가 나타날 경우 해당 물체를 추적하는 모습을 보였다.
  이는 하드웨어 환경 세팅을 통해 단순하게 해결할 수 있으며 이 외에 Canny Edge 알고리즘을 결합하여 SW적으로 해결할 수 있을 것으로 본다.

  cv2에서 제공하는 Canny 함수를 사용하여 원에 가까운 형태를 잡도록 코드를 작성하였으나 원하는 결과를 얻지는 못하였다. Canny 관련 코드 개선이 필요한 상황이다.

  흰색 골프공에 대한 추적을 해결하기 위해 지속적으로 색 범위 설정을 바꿔볼 예정이다.

### HW 디자인 설계

기존 구상안

![hw](/public/3-3/hw.png)

![hw2](/public/3-3/hw2.png)

3D 모델링을 진행하기에 앞서 메이커스페이스 프린터가 출력할 수 있는 사이즈를 알아본 결과 최대 256 x 256 x 256(mm)임을 확인하였다.

우리가 구상하고 있는 프레임은 가장 긴 뼈대가 200 x 8(cm)로 이를 밀리미터로 변환할 시 2000 x 80로 하나의 뼈대를 10개로 나누어 조립해야 했다.
( 조립형태를 생각했을 때 튀어나오는 부분을 고려하면 튀어나온 부분을 제외했을 때 200mm가 적당하다고 판단하였다. )
작은 뼈대 역시 300 x 80으로 2개로 나누어 조립하는 형태로 변경이 필요했다.

![KakaoTalk_20240323_185317061.jpg](/public/3-3/hw3.jpg)

![Untitled](/public/3-3/hw4.png)

![사이즈 및 출력 횟수 대략 구상](/public/3-3/hw5.png)

사이즈 및 출력 횟수 대략 구상

프레임이 한 번에 출력이 되면 문제가 없으나 잘못 출력 되었을 때 3D 프린팅에 소비되는 시간이 많을 것으로 예상된다.
3월27일 전까지 모델링 파일 완성 후 먼저 프로토타입으로 작은 사이즈의 프레임을 출력한 후 문제가 없을 시 원래 사이즈로 출력하기로 했다.

## **개발 중 발생한 이슈 & 해결**

- **이슈 1: 공 추적 진행 중 발생한 에러메세지**

  ```jsx
  [ 48,  63,  94]]], dtype=uint8))
  Traceback (most recent call last):
    File "C:\Users\HanYeJi\Desktop\jetbot\TP\test.py", line 33, in <module>
      frame = vs.read()
              ^^^^^^^^^
  KeyboardInterrupt
  PS C:\Users\HanYeJi\Desktop\jetbot\TP> Python .\test.py
  Traceback (most recent call last):
    File "C:\Users\HanYeJi\Desktop\jetbot\TP\test.py", line 44, in <module>
      frame = imutils.resize(frame, width=600)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    File "C:\Users\HanYeJi\AppData\Local\Programs\Python\Python311\Lib\site-packages\imutils\convenience.py", line 69, in resize
      (h, w) = image.shape[:2]
               ^^^^^^^^^^^
  AttributeError: 'tuple' object has no attribute 'shape
  ```

  **해결 방법:**
  cv2.VideoCapture().read() return 형태에 대한 오류
  tuple(반환값, 이미지)을 return한다.
  imutils.resize(frame, width=600)에서 frame에는 tuple의 반환값 중 이미지 값이 들어가야하는데 이에 반환값(boolean)이 포함되어 있어 발생한 오류이다.
  사용하지 않는 값에 대해 \_ 처리를 하여 해결하였다.

  ```jsx
  // 제대로 frame을 읽을 경우 ret <- boolean
  // fram에는 읽은 프레임이 나옴
  ret, (fram = cap.read());
  ```

<br>

- **이슈 2: 흰생 공 이미지 추적이 되지 않음**
  흰색 골프공에 대하여 lower : 0, 0, 0 upper: 255, 255, 255로 색상 추적을 진행하였으나 실제 골프공은 완벽한 흰색보다는 회색과 파란색이 섞여있는 색상으로 해당 범위로는 추적이 불가능하였다. inRange 예제를 통해서 카메라화면에 보이는 골프공의 BGR 값을 알아낸 후 그 값을 넣어보았으나 해당 값을 넣어도 제대로 추적되지 않았다.

      마우스가 눌린 위치의 BGR값은 : [214 190 174]
      마우스가 눌린 위치의 BGR값은 : [127 119 117]

  **해결 방법:**
  노란색 골프공을 이용하여 범위를 다시 설정하여 공 추적에 성공했으나 하얀 공을 추적하기 위해서는 세밀한 색상 범위 설정이나 inRange 외 다른 방법이 필요하다.

<br>

- **이슈 3: VSCode 인터프리터 설정 문제로 인한 에러메세지**

  ```
  ModuleNotFoundError: No module named 'imutils’
  ModuleNotFoundError: No module named 'cv2’
  ```

  터미널 환경에서 OpenCV와 imutils 라이브러리를 설치 완료하고 VSCode에서 개발을 진행하는데 위와 같은 에러 메세지가 나타났다. 이는 VSCode의 인터프리터 설정 문제로 파악되었다.
  **해결 방법:**
  View → Command palette → ‘python:Select Interprete’ 입력 → 현재 프로젝트에 사용할 파이썬 인터프리터를 선택하여 해결하였다.

  ![Untitled](/public/3-3/trouble1.png)

## **회고**

**회의 전 준비**

생각지 않게 라즈베리파이와 opencv 세팅 과정에서 시간을 너무 많이 소모하였다.
개인 노트북에도 개발하기 위해 필요한 환경을 미리 구성하여 라즈베리파이 사용에 문제가 있을 때 다른 노트북을 이용하여 개발할 수 있도록 한다. (소프트웨어 개발 한정)

**문서화 및 협업 규칙 설정 필요**

회의 진행 후 그날 작성한 코드에 대해 commit 작성이 이루어져야 했으나 이것이 제대로 되지 않았다. 그날 진행한 내용에 대해서는 당일에 커밋을 진행하도록 해야 할 것으로 보인다.

앞으로 프로젝트의 효율성을 높이기 위해 다양한 개발 규칙을 설정하였다.

1.  깃허브 칸반 보드

    - 팀원 사이의 업무 진행 상황 및 프로젝트 진행 상황을 시각적으로 파악하기 쉽다.
    - 개발 전, 개별 작업 카드를 작성하는 과정에서 기능별 요구사항, 우선순위, 작업기간 등을 정의하며 작업의 투명성을 높인다.
    - 프로젝트 레포지토리와 연동을 통해 코드 관련 작업을 효과적으로 관리한다.

2.  컨벤션 설정

        - 브랜치명
          프로젝트의 일관성을 높이고 브랜치명 충돌을 방지하기 위해 통일된 브랜치명을 사용한다.
          타입/세부내용
          타입/#이슈번호/세부내용

    - 브랜치 전략 tech-pioneers의 Git-flow 전략

    - 사용할 브랜치 : master, develop, feature, hotfix
    - feature 브랜치에서 작업 브랜치를 생성한 후 기능이 완성되면 feature 브랜치에 Pull request를 생성한다.
    - feature에 대한 기능 구현 및 테스트를 완료하면 develop 브랜치에 Pull request를 생성한다.
    - Pull request 규칙

            - PR 생성자를 제외한 다른 팀원은 생성된 PR에 대한 코드 리뷰 및 피드백을 진행한다.

            - PR은 최소 1명의 팀원이 리뷰 승인을 한 후에 merge한다.

            <!-- PR 제목 -->
            타입 : #이슈번호/내용

            ## 🚅 PR 한 줄 요약

            PR을 한줄로 요약해주세요.

            ## 🧑‍💻 PR 세부 내용

            수정/추가한 내용을 적어주세요.

            ## 📸 스크린샷

            스크린샷을 첨부해주세요.

          - 커밋 메세지

            - 작업 중 코드 변경 사항 및 디버깅을 유용하게 하기 위함으로 아래 규칙을 따른다.

            feat : 새로운 기능 추가
            fix : 버그 수정
            docs : 문서 수정
            style : 코드 포맷팅, 세미콜론 누락, 코드 변경이 없는 경우
            refactor : 코드 리펙토링
            test : 테스트 코드, 리펙토링 테스트 코드 추가
            chore : 빌드 업무 수정, 패키지 매니저 수정

3.  문제 해결 및 이슈 관리

    - 새로운 기능 제안 및 버그 발생 등에 대해 이슈를 생성한다.
    - 코멘트와 멘션을 통해 팀원들과 해당 이슈에 대해 토론한다.

      - 긴급한 이슈의 경우 추가 회의를 진행한다.

      ```
      ## 🚅 Issue 한 줄 요약

      이슈를 한줄로 요약해주세요.

      ## 🤷 Issue 세부 내용

      무슨 이슈인가요?

      ## ✨ 기대 결과

      어떤 결과물을 원하시나요?

      ## 📸 스크린샷

      이슈에 해당하는 부분을 보여주세요.
      ```

    - 개발 중 발생한 에러가 발생할 경우 해당 에러메시지를 반드시 캡쳐 해야 한다. 3월 3주차에는 에러메지 일부를 텍스트로 남겼으나 에러메시지 전체에 대한 텍스트와 캡처본을 남기는 것이 좋아보인다. 이는 트러블슈팅에 큰 도움을 줄 것이다.

## **TO DO LIST**

**물품 도착 전까지**

1. 3D 모델링 디자인 완성
2. 메이커스페이스 예약
3. 공 추적 알고리즘 개선 - Canny Edge
